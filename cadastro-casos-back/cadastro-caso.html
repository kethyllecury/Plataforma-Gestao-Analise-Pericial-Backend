<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Caso</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>
    <header class="d-flex justify-content-between align-items-center p-3 bg-dark text-white">
        <div class="menu-icon fs-4">&#9776;</div>
        <div class="user-icon fs-4"><i class="fas fa-user"></i></div>
    </header>

    <div class="container mt-4 mb-4">

        <form id="formCaso" class="row g-1 needs-validation" novalidate>

            <h2 class="mb-3">Cadastre novo caso</h2>

            <div class="col-12 col-md-10">
                <label for="nome" class="form-label">Nome *</label>
                <input type="text" id="nome" name="nome" class="form-control" placeholder="Digite o título do caso" required>
            </div>

            <div class="col-md-10">
                <label for="local" class="form-label">Local *</label>
                <input type="text" id="local" name="local" class="form-control" placeholder="Digite o local do caso" required>
            </div>

            <div class="col-md-10">
                <label for="data" class="form-label">Data *</label>
                <input type="date" id="data" name="data" class="form-control" required>
            </div>

            <div class="col-md-10">
                <label for="hora" class="form-label">Hora *</label>
                <input type="time" id="hora" name="hora" class="form-control" required>
            </div>

            <div class="col-10">
                <label for="descricao" class="form-label">Descrição *</label>
                <textarea id="descricao" name="descricao" class="form-control" rows="3" placeholder="Digite a descrição do caso" required></textarea>
            </div>

            <div class="col-md-10">
                <label for="tipo" class="form-label">Tipo *</label>
                <select id="tipo" name="tipo" class="form-select" required>
                    <option value="">Selecione o tipo do caso</option>
                    <option value="Acidente">Acidente</option>
                    <option value="Identificação de vitima">Identificação de vitima</option>
                    <option value="Exame criminal">Exame criminal</option>
                    <option value="Erro odontológico">Erro odontológico</option>
                </select>
            </div>

            <div class="col-md-10">
                <label for="perito" class="form-label">Perito responsável *</label>
                <input type="text" id="perito" name="perito" class="form-control" placeholder="Digite o nome do perito responsável" required>
            </div>

            <div class="col-10">
                <label for="anexos" class="form-label">Anexo(s)</label>
                <input type="file" id="anexos" name="anexos" class="form-control" multiple accept="image/*">

            </div>

            <div class="col-12 d-flex justify-content-center">
                <button class="btn btn-custom" type="submit">Cadastrar caso</button>
            </div>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.getElementById('formCaso').addEventListener('submit', async function (event) {
            event.preventDefault();

            const formData = new FormData(this);

            const dados = {
                nome: formData.get('nome'),
                local: formData.get('local'),
                data: formData.get('data'),
                hora: formData.get('hora'),
                descricao: formData.get('descricao'),
                tipo: formData.get('tipo'),
                perito: formData.get('perito'),
                anexos: [] 
            };

            try {
                const response = await fetch('http://localhost:8000/api/casos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(dados)
                });

                const result = await response.json();

                if (response.ok) {
                    alert('Caso cadastrado com sucesso!');
                    this.reset();
                } else {
                    alert(' Erro ao cadastrar: ' + result.error);
                }
            } catch (err) {
                alert(' Erro na requisição: ' + err.message);
            }
        });
    </script>
</body>
</html>
